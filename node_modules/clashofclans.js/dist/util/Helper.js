"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.isWarWinner = exports.getWarResult = exports.isFriendlyWar = exports.calculateOffensiveRaidMedals = exports.calculateRaidsCompleted = void 0;
const Constants_1 = require("./Constants");
const calculateRaidsCompleted = (attackLog) => {
    let total = 0;
    for (const clan of attackLog) {
        if (clan.districtsDestroyed === clan.districtCount)
            total += 1;
    }
    return total;
};
exports.calculateRaidsCompleted = calculateRaidsCompleted;
const calculateOffensiveRaidMedals = (attackLog) => {
    const districtMap = {
        1: 135,
        2: 225,
        3: 350,
        4: 405,
        5: 460
    };
    const capitalMap = {
        2: 180,
        3: 360,
        4: 585,
        5: 810,
        6: 1115,
        7: 1240,
        8: 1260,
        9: 1375,
        10: 1450
    };
    let totalMedals = 0;
    let attacksDone = 0;
    for (const clan of attackLog) {
        attacksDone += clan.attackCount;
        for (const district of clan.districts) {
            if (district.destructionPercent === 100) {
                if (district.id === 70000000) {
                    totalMedals += capitalMap[district.districtHallLevel];
                }
                else {
                    totalMedals += districtMap[district.districtHallLevel];
                }
            }
        }
    }
    if (totalMedals !== 0)
        totalMedals = Math.ceil(totalMedals / attacksDone);
    return totalMedals;
};
exports.calculateOffensiveRaidMedals = calculateOffensiveRaidMedals;
const isFriendlyWar = (preparationStartTime, startTime) => {
    const preparationTime = startTime.getTime() - preparationStartTime.getTime();
    return Constants_1.FriendlyWarPreparationTimes.includes(preparationTime);
};
exports.isFriendlyWar = isFriendlyWar;
const getWarResult = (clan, opponent) => {
    if (clan.stars > opponent.stars)
        return 'win';
    if (clan.stars === opponent.stars) {
        if (clan.destructionPercentage > opponent.destructionPercentage)
            return 'win';
        if (clan.destructionPercentage === opponent.destructionPercentage)
            return 'tie';
    }
    return 'lose';
};
exports.getWarResult = getWarResult;
const isWarWinner = (clan, opponent) => {
    const result = (0, exports.getWarResult)(clan, opponent);
    return result === 'win';
};
exports.isWarWinner = isWarWinner;
